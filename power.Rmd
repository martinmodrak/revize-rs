---
title: "Power analysis pro hlavní část"
output: html_notebook
---

```{r setup}
library(pwr)
library(here)
library(brms)
library(tidyverse)
```

A quick frequentist estimate

```{r}
power = 0.8
alpha = 0.05
power_vals <- tibble(n_predictors = c(10, 20, 30)) %>%
  #crossing(tibble(f2 = c(0.02, 0.15, 0.35))) %>%
  crossing(tibble(sample_size = seq(from = 100, to = 1500, length.out = 100) %>% round())) %>%
  rowwise() %>%
  mutate(f2 = pwr.f2.test(u = n_predictors, v = sample_size - n_predictors - 1, sig.level = alpha, power = power)$f2) %>%
  ungroup()


power_vals %>%
  mutate(n_predictors = as.factor(n_predictors)) %>%
  ggplot(aes(x = sample_size, y = f2, color = n_predictors, group = n_predictors )) +
  geom_line() +
  geom_hline(yintercept = 0.02) +
  geom_hline(yintercept = 0.15) +
  geom_hline(yintercept = 0.35) +
  scale_y_log10()
  
```

```{r}
mock_data <- readxl::read_excel(here("public_data","mock_hlavni_cast.xlsx"), sheet = "Respondenti") %>%
  inner_join(readxl::read_excel(here("public_data","mock_hlavni_cast.xlsx"), sheet = "Kompetence"), by = c("respondent" = "respondent"))
```


```{r}

formula_ideal <- brmsformula(potreba_rozvoje ~ (1|kompetence) + mo(zivotni_spokojenost) + mo(funkcni_druzinovy_system) + (0 + mo(zivotni_spokojenost)|kompetence) + (0 + funkce|kompetence) + (0 + vek|kompetence) , family = cumulative("logit"))
get_prior(formula_ideal, data =  mock_data)

#fit <- brm(formula_ideal, data = mock_data, chains = 1, iter = 300)
#fit
make_stancode(formula_ideal, mock_data)
```

