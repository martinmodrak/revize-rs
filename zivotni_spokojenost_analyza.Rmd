---
title: "Zivotni spokojenost"
output: html_document
---

```{r setup}
source(here::here("R","setup_dotaznik.R"), encoding = "UTF-8")

pridej_pocty_mc <- function(cela_data) {
  cela_data %>%
    mutate(n_roli = cela_data %>% select(starts_with("role_skauting.")) %>% rowSums(),
           n_sluzba = cela_data %>% dplyr::select(starts_with("sluzba.")) %>% rowSums(),
           n_nastroje = cela_data %>% dplyr::select(starts_with("vychovne_nastroje.")) %>% rowSums(),
           n_s_cim_spokojen = cela_data %>% dplyr::select(starts_with("s_cim_spokojen.")) %>% rowSums(),
           n_s_cim_nespokojen = cela_data %>% dplyr::select(starts_with("s_cim_nespokojen.")) %>% rowSums())

}

```

```{r}
cela_data_raw <- nacti_dotaznik()
cela_data <- cela_data_raw %>% vyfiltruj_pouzitelne() %>% preprocess_dat(verbose = FALSE) 
check_vysledky(cela_data)
cela_data <- cela_data %>% rozsir_vsechna_mc() %>% pridej_pocty_mc()

```

```{r zakladni lss analyzy}

cor.test(~let_v_junaku+lss,cela_data)
cela_data %>% 
  group_by(pocet_clenu_spolecenstvi) %>% 
  summarize(lss = mean(lss, na.rm=T)) %>% 
  ggplot(aes(x=as.character(pocet_clenu_spolecenstvi),y=lss),cela_data) + geom_bar(stat = "identity")

cela_data %>% 
  mutate(frekvence_kratkych_akci = factor(frekvence_kratkych_akci, levels = c("nikdy","rocne","nekolik_rocne","mesicne","nekolik_mesicne","tydne","nekolik_tydne"))) %>% 
  group_by(frekvence_kratkych_akci) %>% 
  summarize(lss = mean(lss, na.rm=T)) %>% 
  ggplot(aes(x=frekvence_kratkych_akci,y=lss),cela_data) + geom_bar(stat = "identity")

cela_data %>% 
  mutate(frekvence_kratkych_akci = factor(frekvence_kratkych_akci, levels = c("nikdy","rocne","nekolik_rocne","mesicne","nekolik_mesicne","tydne","nekolik_tydne"))) %>% 
  group_by(frekvence_kratkych_akci) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm=T)) %>% 
  ggplot(aes(x=frekvence_kratkych_akci,y=spokojenost_clenstvim_v_rs),cela_data) + geom_bar(stat = "identity")

p1 <- cela_data %>% 
  mutate(frekvence_vicedennich_akci = factor(frekvence_vicedennich_akci, levels = c("nikdy","mene_nez_rocne","rocne","nekolik_rocne","mesicne","nekolik_mesicne"))) %>% 
  group_by(frekvence_vicedennich_akci) %>% 
  summarize(lss = mean(lss, na.rm=T)) %>% 
  ggplot(aes(x=frekvence_vicedennich_akci,y=lss),cela_data) + geom_bar(stat = "identity") 

p2 <- cela_data %>% 
  mutate(frekvence_vicedennich_akci = factor(frekvence_vicedennich_akci, levels = c("nikdy","rocne","nekolik_rocne","mesicne","nekolik_mesicne","tydne","nekolik_tydne"))) %>% 
  group_by(frekvence_vicedennich_akci) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm=T)) %>% 
  ggplot(aes(x=frekvence_vicedennich_akci,y=spokojenost_clenstvim_v_rs),cela_data) + geom_bar(stat = "identity")
p1/p2

p1 <- cela_data %>% 
  mutate(frekvence_velkych_akci = factor(frekvence_velkych_akci, levels = c("nikdy","mene_nez_rocne","rocne","nekolik_rocne"))) %>% 
  group_by(frekvence_velkych_akci) %>% 
  summarize(lss = mean(lss, na.rm=T)) %>% 
  ggplot(aes(x=frekvence_velkych_akci,y=lss),cela_data) + geom_bar(stat = "identity") 

p2 <- cela_data %>% 
  mutate(frekvence_velkych_akci = factor(frekvence_velkych_akci, levels = c("nikdy","mene_nez_rocne","rocne","nekolik_rocne"))) %>% 
  group_by(frekvence_velkych_akci) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm=T)) %>% 
  ggplot(aes(x=frekvence_velkych_akci,y=spokojenost_clenstvim_v_rs),cela_data) + geom_bar(stat = "identity")
p1/p2


cor.test(~spokojenost_clenstvim_v_rs+lss,cela_data)

lss_pro_kategorie <- function(var) {
  cela_data %>% 
    group_by(!!var) %>% 
    summarize(sd_lss = sd(lss, na.rm = T), n = sum(!is.na(lss)) ,n_NA = sum(is.na(lss)), lss = mean(lss, na.rm = T),
              spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm = T),
              spokojenost_s_fungovanim_v_junaku = mean(spokojenost_s_fungovanim_v_junaku, na.rm = T))
}

lss_pro_kategorie(quo(kategorie_respondenta)) %>% ggplot(aes(x = as.character(kategorie_respondenta), y =lss)) + geom_bar(stat="identity") + xlab("kategorie respondenta") +   theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.5))

lss_pro_kategorie(quo(kategorie_respondenta)) %>% ggplot(aes(x = as.character(kategorie_respondenta), y =spokojenost_clenstvim_v_rs  )) + geom_bar(stat="identity") + xlab("kategorie respondenta") +   theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

lss_pro_kategorie(quo(role_skauting.vedouci_roveru)) %>% ggplot(aes(x = as.character(role_skauting.vedouci_roveru), y =lss)) + geom_bar(stat="identity") + xlab("role skauting") +   theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

lss_pro_kategorie(quo(zivotni_faze)) %>% 
  mutate(zivotni_faze = recode(as.character(zivotni_faze), `1`="Studuji",`2`="Pracuji",`3`="Studuji i pracuji",`4`="Nepracuji ani nestuduji")) %>% 
  ggplot(aes(x = as.character(zivotni_faze), y =spokojenost_clenstvim_v_rs  )) + geom_bar(stat="identity") + xlab("zivotni_faze") +   
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

lss_pro_kategorie(quo(zivotni_faze)) %>% 
  mutate(zivotni_faze = recode(as.character(zivotni_faze), `1`="Studuji",`2`="Pracuji",`3`="Studuji i pracuji",`4`="Nepracuji ani nestuduji")) %>% 
  ggplot(aes(x = as.character(zivotni_faze), y =lss  )) + geom_bar(stat="identity") + xlab("zivotni_faze")
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

lss_pro_kategorie(quo(kraj)) %>% 
  ggplot(aes(x = as.character(kraj), y =spokojenost_clenstvim_v_rs  )) + geom_bar(stat="identity") + xlab("zivotni_faze") +   
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

kraj_val <- lss_pro_kategorie(quo(kraj)) %>% 
  arrange(lss) %>% 
  mutate(kraj = haven::as_factor(kraj) %>% as.character()) %>% pull(kraj)

lss_pro_kategorie(quo(kraj)) %>% 
  arrange(lss) %>% 
  mutate(kraj = haven::as_factor(kraj) %>% as.character()) %>% 
  mutate(kraj = factor(kraj, levels = kraj_val)) %>% 
  ggplot(aes(x = kraj, y =lss  )) + geom_bar(stat="identity") + xlab("kraj")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

kraj_val <- lss_pro_kategorie(quo(kraj)) %>% 
  arrange(spokojenost_clenstvim_v_rs) %>% 
  mutate(kraj = haven::as_factor(kraj) %>% as.character()) %>% pull(kraj)

lss_pro_kategorie(quo(kraj)) %>% 
  arrange(spokojenost_clenstvim_v_rs) %>% 
  mutate(kraj = haven::as_factor(kraj) %>% as.character()) %>% 
  mutate(kraj = factor(kraj, levels = kraj_val)) %>% 
  ggplot(aes(x = kraj, y =spokojenost_clenstvim_v_rs  )) + geom_bar(stat="identity") + xlab("kraj")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

lss_pro_kategorie(quo(sex)) %>% 
  ggplot(aes(x = sex, y =spokojenost_clenstvim_v_rs  )) + geom_bar(stat="identity") + xlab("pohlavi")+theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
lss_pro_kategorie(quo(sex)) %>% 
  ggplot(aes(x = sex, y =lss  )) + geom_bar(stat="identity") + xlab("pohlavi")+theme(axis.text.x = element_text(angle = 45, hjust = 1))
    

lss_pro_kategorie(quo(sex))

```



```{r rozdelejless pro mc}


cela_data %>% select(starts_with("roleFA_"),lss) %>% cor(use = "complete.obs") %>% knitr::kable(digits = 2)

n_roli_tmp <- rowSums(cela_data %>% select(starts_with("role_skauting.")) %>% as.matrix())

cela_data <- cela_data %>% 
  mutate(n_roli = n_roli_tmp)
cela_data %>% 
  group_by(n_roli) %>% 
  summarize(lss = mean(lss, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_roli, y = lss, size = n)) + geom_point()

cela_data %>% 
  group_by(n_roli) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_roli, y = spokojenost_clenstvim_v_rs, size = n)) + geom_point()

cela_data %>% 
   group_by(n_sluzba) %>% 
   summarize(lss = mean(lss, na.rm = T), n =n()) %>% 
 ggplot(aes(x=n_sluzba, y = lss, size = n)) + geom_point()

cela_data %>% 
  group_by(n_sluzba) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_sluzba, y = spokojenost_clenstvim_v_rs, size = n)) + geom_point()

cela_data %>% 
  group_by(n_s_cim_spokojen) %>% 
  summarize(lss = mean(lss, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_s_cim_spokojen, y = lss, size = n)) + geom_point()

cela_data %>% 
  group_by(n_s_cim_spokojen) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_s_cim_spokojen, y = spokojenost_clenstvim_v_rs, size = n)) + geom_point()

cela_data %>% 
  group_by(n_s_cim_nespokojen) %>% 
  summarize(lss = mean(lss, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_s_cim_nespokojen, y = lss, size = n)) + geom_point()

cela_data %>% 
  group_by(n_s_cim_nespokojen) %>% 
  summarize(spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_s_cim_nespokojen, y = spokojenost_clenstvim_v_rs, size = n)) + geom_point()



cela_data %>% 
  group_by(role_skauting.vedouci_roveru) %>% 
  summarize(lss = mean(lss, na.rm =T),
            spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm =T),
            n = n()) %>% 
  ggplot(aes(x=role_skauting.vedouci_roveru, y = spokojenost_clenstvim_v_rs, size = n)) + geom_bar(stat = "identity")

cela_data %>% 
  group_by(role_skauting.vedouci_roveru) %>% 
  summarize(lss = mean(lss, na.rm =T),
            spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm =T),
            n = n()) %>% 
  ggplot(aes(x=role_skauting.vedouci_roveru, y = lss, size = n)) + geom_bar(stat = "identity")



cela_data %>% 
  group_by(role_skauting.tahoun_roveru) %>% 
  summarize(m_spoko = mean(spokojenost_clenstvim_v_rs, na.rm =T),
            sd_spoko = sd(spokojenost_clenstvim_v_rs, na.rm =T),
            n = n())

cela_data %>% 
  group_by(role_skauting.tahoun_roveru) %>% 
  summarize(m_lss = mean(lss, na.rm =T),
            sd_lss = sd(lss, na.rm =T),
            n = n())

cela_data %>% select(starts_with("roleFA_"), lss) %>% cor(use = "complete.obs") %>% ggcorrplot::ggcorrplot(hc.order = T, type = "lower", lab =T)

t.test(spokojenost_clenstvim_v_rs~role_skauting.vedouci_roveru,cela_data_role)
t.test(lss~role_skauting.vedouci_roveru,cela_data_role)


```

```{r rozdil kompetencni a lss}
expanded <- cela_data %>% expand_kompetence()

rozdil_dulezite_zvladam <- expanded %>% select(session, lss, kategorie_kompetence, kompetence_odpoved, kompetence) %>% filter(kategorie_kompetence %in% c("dulezite","zvladam")) %>%
  pivot_wider(id_cols = c("session", "kompetence", "lss"), names_from = kategorie_kompetence, values_from = kompetence_odpoved) %>%
  mutate(rozdil_dulezite_zvladam = dulezite - zvladam) %>%
  filter(!is.na(rozdil_dulezite_zvladam))

rozdil_dul_zvl_agg <- rozdil_dulezite_zvladam %>% 
  group_by(session) %>% 
  summarize(lss = mean(lss), rozdil_dulezite_zvladam = mean(rozdil_dulezite_zvladam)) 
rozdil_dul_zvl_agg %>% ggplot(aes(x = rozdil_dulezite_zvladam)) + geom_histogram()
rozdil_dul_zvl_agg %>% 
  cor.test(~lss+rozdil_dulezite_zvladam,.)
rozdil_dul_zvl_agg %>% 
  ggplot(aes(x=rozdil_dulezite_zvladam,y=lss)) + 
  geom_point() +
  stat_smooth()

lss_cor <- expanded %>% select(session, lss, spokojenost_clenstvim_v_rs,kategorie_kompetence, kompetence_odpoved, kompetence) %>% filter(kategorie_kompetence %in% c("dulezite","zvladam","rozvijim","skauting")) %>%
  pivot_wider(id_cols = c("session", "kompetence", "lss","spokojenost_clenstvim_v_rs"), names_from = kategorie_kompetence, values_from = kompetence_odpoved,values_fn = list(kompetence_odpoved = mean)) %>% 
  mutate(dulezite = unlist(dulezite))
  group_by(session) %>% 
  summarize(lss = mean(lss), 
            spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs), 
            dulezite = mean(dulezite),
            zvladam = mean(zvladam),
            rozvijim = mean(rozvijim),
            skauting = mean(skauting)
            )
m <- lss_cor %>% 
  select(lss, spokojenost_clenstvim_v_rs,dulezite, zvladam, rozvijim, skauting) %>% 
  as.matrix() %>% cor(use = "complete.obs") 
m %>% ggcorrplot::ggcorrplot(type = "lower", lab = T)
m <- m %>% 
  round(2) %>% 
  as.character()
m[upper.tri(m)] <- ""
  m %>% knitr::kable(digits = 2)

xxx <- cela_data %>% select(lss,ends_with("zvladam")) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% filter(var!="lss") %>% arrange(lss) %>% mutate(var = str_remove(var, "_zvladam"))
lev <- xxx$var
xxx %>% mutate(zvladam = factor(var, levels = lev, ordered = T)) %>% 
  ggplot(aes(x = zvladam, y = lss)) + geom_bar(stat="identity") + xlab("Zvladam kompetence")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

xxx <- cela_data %>% select(lss,ends_with("rozvijim")) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% filter(var!="lss") %>% arrange(lss) %>% mutate(var = str_remove(var, "_rozvijim"))
lev <- xxx$var
xxx %>% mutate(rozvijim = factor(var, levels = lev, ordered = T)) %>% 
  ggplot(aes(x = rozvijim, y = lss)) + geom_bar(stat="identity") + xlab("Rozvijim kompetence")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

xxx <- cela_data %>% select(lss,ends_with("dulezite")) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% filter(var!="lss") %>% arrange(lss) %>% mutate(var = str_remove(var, "_dulezite"))
lev <- xxx$var
xxx %>% mutate(dulezite = factor(var, levels = lev, ordered = T)) %>% 
  ggplot(aes(x = dulezite, y = lss)) + geom_bar(stat="identity") + xlab("Dulezite kompetence")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

xxx <- cela_data %>% select(lss,ends_with("skauting"),-role_skauting) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% filter(var!="lss") %>% arrange(lss) %>% mutate(var = str_remove(var, "_skauting"))
lev <- xxx$var
xxx %>% mutate(skauting = factor(var, levels = lev, ordered = T)) %>% 
  ggplot(aes(x = skauting, y = lss)) + geom_bar(stat="identity") + xlab("Skauting kompetence")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


## Roverske nastroje

```{r roverske nastroje faktorova analyza}
role_fa <- cela_data_role %>% select(starts_with("vychovne_nastroje."))
role_fa <- sapply(role_fa, as.character)
het.mat <- hetcor(role_fa)$cor
het.mat %>% knitr::kable(digits = 2)

psych::fa.parallel(het.mat, n.obs = nrow(role_fa))

nastroje_fa_res <- psych::fa(het.mat, n.obs = nrow(role_fa), nfactors = 3, rotate = "varimax")
nastroje_fa_res
```

```{r roverske nastroje a spokojenost}

cr <- cela_data %>% select(starts_with("vychovne_nastroje."),lss, spokojenost_clenstvim_v_rs) %>% as.matrix() %>% Hmisc::rcorr() 
cr$r %>%   knitr::kable(digits = 2)
ggcorrplot::ggcorrplot(cr$r,hc.order = T, type = "lower", lab =T)
```


## Co pomaha roveringu

```{r}
cela_data %>% select(starts_with("co_pomaha_")) %>% colnames()
xtabs(~co_pomaha_roveringu.financni_podpora+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.zpravodal+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.vyssi_mista+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.roversky_program+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.SI+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.akce_kratke+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.akce_dlouhe+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu.neformalni_setkani+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_socialni_site+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)

```

Obecne lidem, co maji zkusenost s roveringem prijde, ze pomahaji neformalni setkani oproti tem, co nikdy ve spolecentstvi nebyli (ti veri na program). Je to tedy dost o vztazizch a neformalnich setkavani

## Problemy roveringu

```{r}
cela_data %>% select(starts_with("problemy")) %>% colnames()
xtabs(~problemy_roveringu.stredisko+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.odstehovani+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.nevidi_smysl+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.spatne_vztahy+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.bez_kvalitniho_programu+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.bez_vedeni+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.nevime_jak+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.vytizeni_oddily+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.vytizeni_mimo+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu.pracovni_ceta+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)

```

## Faktorovka - co pomaha a co ne

```{r}
pomaha_skodi <- cela_data %>% select(starts_with("problemy_roveringu."),-starts_with("problemy_roveringu.stredisko"),starts_with("co_pomaha."),-co_pomaha_roveringu,-problemy_roveringu.stredisko)
psych::fa.parallel(pomaha_skodi)
fa_pomahaskodi <- psych::fa(pomaha_skodi,nfactors = 6, rotate = "varimax")
zobraz_fa(fa_pomahaskodi,nfac = 6,str_to_remove = "problemy_roveringu.") %>% knitr::kable()
cela_data <- vytvor_promenne_dle_fa(cela_data,pomaha_skodi,fa_pomahaskodi,var_name = "pomahaskodi") %>% 
  rename(ps_spatny_program = pomahaskodi1,
         ps_akcickari = pomahaskodi2,
         ps_podpora_zvenku = pomahaskodi3,
         ps_vytizeni_a_mimo = pomahaskodi4,
         ps_pokecat_s_kamosi = pomahaskodi5,
         ps_spatne_vztahy = pomahaskodi6)

cr <- cela_data %>% select(starts_with("ps_"),starts_with("roleFA_"),lss,spokojenost_clenstvim_v_rs) %>% as.matrix() %>% Hmisc::rcorr()
ggcorrplot::ggcorrplot(cr$r,hc.order = T, type = "lower", lab =T)

km <- pomaha_skodi %>% kmeans(centers = 6)
cela_data$pomaha_skodi_skupina <- km$cluster
visualizuj_skupinu <- function(df_in, var, which_visualize,str_to_remove ="") {
  df <- df_in %>%
    dplyr::select(!!var, !!which_visualize) %>% 
    pivot_longer(cols = !!which_visualize,names_to = "promenna", values_to = "hodnota") %>% 
    group_by(!!var, promenna) %>% 
    summarize(hodnota = mean(hodnota))
   df %>% 
     mutate(promenna = str_remove(promenna, str_to_remove)) %>% 
     ggplot(aes(x = promenna, y = hodnota)) + 
     geom_bar(stat = "identity") +
     facet_grid(rows = vars(!!var)) + 
     theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

visualizuj_skupinu(quo(pomaha_skodi_skupina), colnames(pomaha_skodi))

role_data <- cela_data %>% 
  filter(role_skauting!="")

clustery_role <- role_data %>% 
  dplyr::select(starts_with("role_skauting.")) %>% 
  kmodes(7)
role_data$role_skupina <- clustery_role$cluster

which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("role_skauting.")))
visualizuj_skupinu(role_data,quo(role_skupina), which_visualize, str_to_remove = "role_skauting.")

# 
vis_role2 <- function(ncl) {
  role_data <- cela_data %>% 
  filter(role_skauting!="")

clustery_role <- role_data %>% 
  dplyr::select(starts_with("role_skauting.")) %>% 
  kmodes(ncl)
role_data$role_skupina <- clustery_role$cluster

which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("role_skauting.")))
visualizuj_skupinu(role_data,quo(role_skupina), which_visualize, str_to_remove = "role_skauting.")
}

mds_df <- role_data %>% dplyr::select(starts_with("role_skauting.")) %>% as.matrix() %>% 
  vegan::vegdist(method = "jaccard",binary = T) %>% 
  cmdscale() 
colnames(mds_df) <- c("mds_x", "mds_y")

plot(mds_df)

mds_df2 <- role_data %>% dplyr::select(starts_with("role_skauting.")) %>% as.matrix() %>% 
  vegan::metaMDS(distance = "jaccard",binary = T)

plot(mds_df2)

g <- ggplot(df, aes()) + geom_point(aes(x = mds_x, y = mds_y), size = 5)
g <- g + geom_text(aes(x = mds_x, y = mds_y, label = tags), position = position_jitter(width = 0.05, height = 0.05))
g <- g + xlab("Coordinate 1") + ylab("Coordinate 2")
print(g)

vis_role <- function(ncl) {
  role_data <- cela_data %>% 
  filter(role_skauting!="")

clustery_role <- role_data %>% 
  dplyr::select(starts_with("roleFA_")) %>% 
  kmeans(ncl)
role_data$role_skupina <- clustery_role$cluster

which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("roleFA_")))
visualizuj_skupinu(role_data,quo(role_skupina), which_visualize, str_to_remove = "roleFA_")
}
vis_role(10)

vis_role2(2)
vis_role2(3)
vis_role2(4)
vis_role2(5)
vis_role2(6)
vis_role2(7)
vis_role2(9)
vis_role2(15)

role_m <- cela_data %>% 
  filter(role_skauting!="") %>% 
  dplyr::select(starts_with("role_skauting."))
  

```

```{r}
kompetence_fa<- expanded %>% filter(kategorie_kompetence=="dulezite") %>% dplyr::select(session,kompetence, kompetence_odpoved) %>% 
  pivot_wider(values_from = kompetence_odpoved,names_from = kompetence,values_fn = list(kompetence_odpoved = mean)) %>% dplyr::select(-session)

kompetence_fa %>% psych::fa.parallel()
kompetence_fa %>% psych::fa(nfactors = 7, rotate = "promax") %>% zobraz_fa(nfac=7,str_to_remove = "NA") %>% knitr::kable(digits =2 )
kompetence_fa %>% psych::fa(nfactors = 6, rotate = "promax") %>% zobraz_fa(nfac=6,str_to_remove = "NA") %>% knitr::kable(digits =2 )
kompetence_fa %>% psych::fa(nfactors = 5, rotate = "promax") %>% zobraz_fa(nfac=5,str_to_remove = "NA") %>% knitr::kable(digits =2 )
```

```{r}
mds_df <- role_data %>% dplyr::select(starts_with("role_skauting.")) %>% as.matrix() %>% 
  vegan::vegdist(method = "jaccard",binary = T) %>% 
  cmdscale(k=2) 


mds2_df <- role_data %>% dplyr::select(starts_with("role_skauting.")) %>% as.matrix() %>% 
  vegan::vegdist(method = "jaccard",binary = T) %>% 
  cmdscale(k=10) 


km <- kmeans(mds2_df,3)
plot(mds_df, col = km$cluster)

role_data$skupina <- km$cluster
which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("role_skauting.")))

visualizuj_skupinu(role_data,quo(skupina), which_visualize, str_to_remove = "role_skauting.")

table(role_data$kategorie_respondenta_full,role_data$skupina)
```

## Lidi, co jezdi na kurzy


```{r}
cela_data %>% 
  group_by(co_zazil_radcovsky_kurz) %>% 
  summarize(lss = mean(lss, na.rm = T),
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_clenstvim_v_rs = mean(spokojenost_clenstvim_v_rs, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) 

cela_data %>% 
  group_by(co_zazil_cekatelky) %>% 
   summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_clenstvim_v_rs, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=co_zazil_cekatelky)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

cela_data %>% 
  group_by(co_zazil_vudcovky) %>% 
   summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_clenstvim_v_rs, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=co_zazil_vudcovky)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
cela_data %>% 
  group_by(co_zazil_roversky_kurz) %>% 
  summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_clenstvim_v_rs, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=co_zazil_roversky_kurz)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
```

# Vek a breaking points

```{r}
cela_data1 <- cela_data %>% filter(age >= 15 & age <=26)
p1 <-cela_data1 %>% ggplot(aes(x = age, y = lss)) + stat_smooth(method = "loess")
p2 <-cela_data1 %>% ggplot(aes(x = age, y = spokojenost_clenstvim_v_rs)) + stat_smooth(method = "loess")
p3 <-cela_data1 %>% ggplot(aes(x = age, y = n_roli)) + stat_smooth(method = "loess")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = n_sluzba)) + stat_smooth(method = "loess")
cela_data1 %>% ggplot(aes(x = age, y = n_s_cim_spokojen)) + stat_smooth(method = "loess")
cela_data1 %>% ggplot(aes(x = age, y = n_s_cim_nespokojen)) + stat_smooth(method = "loess")

(p1|p2)/(p3|p4)

p1 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_financni_podpora))) + stat_smooth(method = "loess") + ggtitle("Financni podpora") +ylab("procenta")
p2 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_vyssi_mista))) + stat_smooth(method = "loess") + 
  ggtitle("Vyssi mista") +ylab("procenta")
p3 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_roversky_program))) + stat_smooth(method = "loess") +
  ggtitle("Roversky program") +ylab("procenta")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_akce_kratke))) + stat_smooth(method = "loess") +
  ggtitle("Kratke akce") +ylab("procenta")
p5 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_akce_dlouhe))) + stat_smooth(method = "loess") +
  ggtitle("Dlouhe akce") +ylab("procenta")
p6 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_neformalni_setkani))) + stat_smooth(method = "loess") +
  ggtitle("Neformalni setkani") +ylab("procenta")
p7 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_socialni_site))) + stat_smooth(method = "loess") +
  ggtitle("Socialni site") +ylab("procenta")
p8 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_jine))) + stat_smooth(method = "loess") +
  ggtitle("Jine") +ylab("procenta")

(p1|p2|p3|p4)/(p5|p6|p7|p8)


p1 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_pravidelne))) + stat_smooth(method = "loess") + ggtitle("Stredisko pravidelne") +ylab("procenta")
p2 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_je_spolecenstvi))) + stat_smooth(method = "loess") + 
  ggtitle("Je spolecenstvi") +ylab("procenta")
p3 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_vlastni_akce))) + stat_smooth(method = "loess") +
  ggtitle("Vlastni akce") +ylab("procenta")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_akce_pro_druhe))) + stat_smooth(method = "loess") +
  ggtitle("Akce pro druhe") +ylab("procenta")
p5 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_rozviji_se))) + stat_smooth(method = "loess") +
  ggtitle("Rozviji se") +ylab("procenta")
p6 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_roverske_heslo))) + stat_smooth(method = "loess") +
  ggtitle("Roverske heslo") +ylab("procenta")
p7 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_vedou))) + stat_smooth(method = "loess") +
  ggtitle("Stredisko vedou") +ylab("procenta")
p8 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.stredisko_bez_ulohy))) + stat_smooth(method = "loess") +
  ggtitle("Stredisko - bez ulohy") +ylab("procenta")

(p1|p2|p3|p4)/(p5|p6|p7|p8)

cela_data1 %>% group_by(age) %>% summarize(n =sum(!is.na(vyroky_o_roveringu.stredisko_bez_ulohy)),vyroky_o_roveringu.stredisko_bez_ulohy = mean(vyroky_o_roveringu.stredisko_bez_ulohy,na.rm=T)) %>% 
  ggplot(aes(x=age,y=vyroky_o_roveringu.stredisko_bez_ulohy, size = n)) + geom_point()


p1 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_pro_jednu_gen))) + stat_smooth(method = "loess") + ggtitle("Zazil pro jednu generaci") +ylab("procenta")
p2 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_podpora_strediska))) + stat_smooth(method = "loess") + 
  ggtitle("Podpora strediska") +ylab("procenta")
p3 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_rovering_na_SR))) + stat_smooth(method = "loess") +
  ggtitle("Rovering na SR") +ylab("procenta")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_vedeni_je_rovering))) + stat_smooth(method = "loess") +
  ggtitle("Vedeni je rovering") +ylab("procenta")
p5 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_koedukovany))) + stat_smooth(method = "loess") +
  ggtitle("Koedukovany") +ylab("procenta")
p6 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_spoluprace_mimo_stredisko))) + stat_smooth(method = "loess") +
  ggtitle("Spoluprace mimo stredisko") +ylab("procenta")
p7 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu.zazil_kurzy_akce))) + stat_smooth(method = "loess") +
  ggtitle("Kurzy akce") +ylab("procenta")

(p1|p2|p3|p4)/(p5|p6|p7)
plot_vek_loess <- function(var,to_remove ) {
  cela_data1 %>% mutate(procenta = !!var) %>% 
    mutate(procenta = 100*as.numeric(procenta)) %>% 
    ggplot(aes(x = age, y = procenta)) + stat_smooth(method = "loess") + ggtitle(str_remove(as_label(quo(!!var)),to_remove)) 
}

plot_letvjunaku_loess <- function(var,to_remove ) {
  cela_data1 %>% mutate(procenta = !!var) %>% 
    mutate(procenta = 100*as.numeric(procenta)) %>% 
    ggplot(aes(x = let_v_junaku, y = procenta)) + stat_smooth(method = "loess") + ggtitle(str_remove(as_label(quo(!!var)),to_remove)) 
}

p1 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_rover_automaticky),"vyroky_o_roveringu.zazil_2")
p2 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_vstupni_ritual),"vyroky_o_roveringu.zazil_2")
p3 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_snadny_prechod),"vyroky_o_roveringu.zazil_2")
p4 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_pri_prechodu_schopny),"vyroky_o_roveringu.zazil_2")
p5 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_mladsi_starsi),"vyroky_o_roveringu.zazil_2")
p6 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_prechodovy_ritual),"vyroky_o_roveringu.zazil_2")
p7 <- plot_vek_loess(quo(vyroky_o_roveringu.zazil_2_roversky_slib),"vyroky_o_roveringu.zazil_2")

(p1|p2|p3|p4)/(p5|p6|p7)

p1 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_email),"komunikacni_kanaly_existujici_")
p2 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_instagram),"komunikacni_kanaly_existujici_")
p3 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_SI),"komunikacni_kanaly_existujici_")
p4 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_diar),"komunikacni_kanaly_existujici_")
p5 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_casopis_kmen),"komunikacni_kanaly_existujici_")
p6 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_facebook),"komunikacni_kanaly_existujici_")
p7 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_krizovatka),"komunikacni_kanaly_existujici_")
p8 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_vedouci),"komunikacni_kanaly_existujici_")
(p1|p2|p3|p4)/(p5|p6|p7|p8)

p1 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_knihy),"komunikacni_kanaly_existujici_")
p2 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_rovernet),"komunikacni_kanaly_existujici_")
p3 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_roverska_aplikace),"komunikacni_kanaly_hypoteticke_")
p4 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_online_kalendar),"komunikacni_kanaly_hypoteticke_")
p5 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_web),"komunikacni_kanaly_hypoteticke_")
p6 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_e_knihy),"komunikacni_kanaly_hypoteticke_")
(p1/p2)
(p3|p4)/(p5|p6)
```

### Let v Junaku

```{r}
p1 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_email),"komunikacni_kanaly_existujici_")
p2 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_instagram),"komunikacni_kanaly_existujici_")
p3 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_SI),"komunikacni_kanaly_existujici_")
p4 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_diar),"komunikacni_kanaly_existujici_")
p5 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_casopis_kmen),"komunikacni_kanaly_existujici_")
p6 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_facebook),"komunikacni_kanaly_existujici_")
p7 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_krizovatka),"komunikacni_kanaly_existujici_")
p8 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_vedouci),"komunikacni_kanaly_existujici_")
(p1|p2|p3|p4)/(p5|p6|p7|p8)

p1 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_rover_automaticky),"vyroky_o_roveringu.zazil_2_")
p2 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_vstupni_ritual),"vyroky_o_roveringu.zazil_2_")
p3 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_snadny_prechod),"vyroky_o_roveringu.zazil_2_")
p4 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_pri_prechodu_schopny),"vyroky_o_roveringu.zazil_2_")
p5 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_mladsi_starsi),"vyroky_o_roveringu.zazil_2_")
p6 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_prechodovy_ritual),"vyroky_o_roveringu.zazil_2_")
p7 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu.zazil_2_roversky_slib),"vyroky_o_roveringu.zazil_2_")

(p1|p2|p3|p4)/(p5|p6|p7)

p1 <- plot_letvjunaku_loess(quo(vychovne_nastroje_jine),"vychovne_nastroje_")
p2 <- plot_letvjunaku_loess(quo(vychovne_nastroje_vyzvy),"vychovne_nastroje_")
p3 <- plot_letvjunaku_loess(quo(vychovne_nastroje_projekty),"vychovne_nastroje_")
p4 <- plot_letvjunaku_loess(quo(vychovne_nastroje_diar),"vychovne_nastroje_")
p5 <- plot_letvjunaku_loess(quo(vychovne_nastroje_zacatek),"vychovne_nastroje_")
p6 <- plot_letvjunaku_loess(quo(vychovne_nastroje_casopis_kmen),"vychovne_nastroje_")
p7 <- plot_letvjunaku_loess(quo(vychovne_nastroje_vlastni_stezky),"vychovne_nastroje_")
p8 <- plot_letvjunaku_loess(quo(vychovne_nastroje_odborky),"vychovne_nastroje_")

(p1|p2|p3|p4)/(p5|p6|p7|p8)

p1 <- plot_letvjunaku_loess(quo(vychovne_nastroje_zahranici),"vychovne_nastroje_")
p2 <- plot_letvjunaku_loess(quo(vychovne_nastroje_velke_akce),"vychovne_nastroje_")
p3 <- plot_letvjunaku_loess(quo(vychovne_nastroje_kurzy),"vychovne_nastroje_")
p4 <- plot_letvjunaku_loess(quo(vychovne_nastroje_putovani),"vychovne_nastroje_")
p5 <- plot_letvjunaku_loess(quo(vychovne_nastroje_rovernet),"vychovne_nastroje_")
p6 <- plot_letvjunaku_loess(quo(vychovne_nastroje_wiki),"vychovne_nastroje_")
p7 <- plot_letvjunaku_loess(quo(vychovne_nastroje_nic),"vychovne_nastroje_")

(p1|p2|p3|p4)/(p5|p6|p7)
```

## Roveri v kmeni vs roveri bez kmene

```{r}
typ_respondednta_plot <- function(var) {
  
  cela_data1 %>% mutate(kategorie_respondenta_full = as.character(kategorie_respondenta_full)) %>% 
    ggplot(aes(x=kategorie_respondenta_full, y=!!var)) + stat_summary(fun.data = "mean_cl_boot") +theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
typ_respondednta_plot(quo(lss))
typ_respondednta_plot(quo(spokojenost_clenstvim_v_rs))
typ_respondednta_plot(quo(n_roli))
typ_respondednta_plot(quo(n_sluzba))
typ_respondednta_plot(quo(n_nastroje))
typ_respondednta_plot(quo(n_s_cim_spokojen))
typ_respondednta_plot(quo(n_s_cim_nespokojen))

```

## Muzi vs zeny

```{r}
cela_data %>% 
  mutate(sex = haven::as_factor(sex)) %>% 
  group_by(sex) %>% 
   summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_clenstvim_v_rs, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=sex)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("vychovne_nastroje_")) %>% 
  pivot_longer(cols = starts_with("vychovne_nastroje_"), values_to = "procenta", names_to = "nastroj") %>% 
  mutate(nastroj = str_remove(nastroj,"vychovne_nastroje_"),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=nastroj,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("role_skauting.")) %>% 
  pivot_longer(cols = starts_with("role_skauting."), values_to = "procenta", names_to = "role") %>% 
  mutate(role = str_remove(role,"role_skauting."),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=role,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("s_cim_spokojen_")) %>% 
  pivot_longer(cols = starts_with("s_cim_spokojen_"), values_to = "procenta", names_to = "s_cim_spokojen") %>% 
  mutate(s_cim_spokojen = str_remove(s_cim_spokojen,"s_cim_spokojen_"),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=s_cim_spokojen,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("s_cim_nespokojen_")) %>% 
  pivot_longer(cols = starts_with("s_cim_nespokojen_"), values_to = "procenta", names_to = "s_cim_nespokojen") %>% 
  mutate(s_cim_nespokojen = str_remove(s_cim_nespokojen,"s_cim_nespokojen_"),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=s_cim_nespokojen,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

xtabs(~kategorie_respondenta_full+sex, cela_data)

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("sluzba_")) %>% 
  pivot_longer(cols = starts_with("sluzba_"), values_to = "procenta", names_to = "sluzba") %>% 
  mutate(sluzba = str_remove(sluzba,"sluzba_"),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=sluzba,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("sluzba_")) %>% 
  pivot_longer(cols = starts_with("sluzba_"), values_to = "procenta", names_to = "sluzba") %>% 
  mutate(sluzba = str_remove(sluzba,"sluzba_"),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=sluzba,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("vyroky_o_roveringu."),-starts_with("vyroky_o_roveringu.stredisko"),-vyroky_o_roveringu.zazil,-vyroky_o_roveringu.zazil_2) %>% 
  pivot_longer(cols = starts_with("vyroky_o_roveringu."), values_to = "procenta", names_to = "vyroky_o_roveringu") %>% 
  mutate(vyroky_o_roveringu = str_remove(vyroky_o_roveringu,"vyroky_o_roveringu.zazil_") %>% str_remove("2_"),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=vyroky_o_roveringu,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  filter(sex!=3) %>% 
  mutate(sex = haven::as_factor(sex)) %>%
  select(sex,starts_with("problemy_roveringu."),-starts_with("problemy_roveringu.stredisko")) %>% 
  pivot_longer(cols = starts_with("problemy_roveringu."), values_to = "procenta", names_to = "problemy_roveringu") %>% 
  mutate(problemy_roveringu = str_remove(problemy_roveringu,"problemy_roveringu."),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=problemy_roveringu,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  select(sex,starts_with("fungovani_skautskeho_oddilu.")) %>% 
  pivot_longer(cols = starts_with("fungovani_skautskeho_oddilu."), values_to = "procenta", names_to = "fungovani_skautskeho_oddilu") %>% 
  mutate(fungovani_skautskeho_oddilu = str_remove(fungovani_skautskeho_oddilu,"fungovani_skautskeho_oddilu."),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=fungovani_skautskeho_oddilu,y=procenta,col = sex,group = sex)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```


```{r}
cela_data %>%
  select(pocet_clenu_spolecenstvi,starts_with("fungovani_skautskeho_oddilu.")) %>% 
  pivot_longer(cols = starts_with("fungovani_skautskeho_oddilu."), values_to = "procenta", names_to = "fungovani_skautskeho_oddilu") %>% 
  mutate(fungovani_skautskeho_oddilu = str_remove(fungovani_skautskeho_oddilu,"fungovani_skautskeho_oddilu."),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=fungovani_skautskeho_oddilu,y=procenta,col = pocet_clenu_spolecenstvi,group = pocet_clenu_spolecenstvi)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

cela_data %>% 
  group_by(pocet_clenu_spolecenstvi) %>% 
  summarize(lss = mean(lss, na.rm = T),
            spoko_rp = mean(spokojenost_clenstvim_v_rs),
            n=n())


cela_data %>%
  
    select(pocet_clenu_spolecenstvi,starts_with("vyroky_o_roveringu."),-starts_with("vyroky_o_roveringu.stredisko"),-vyroky_o_roveringu.zazil,-vyroky_o_roveringu.zazil_2) %>% 
  pivot_longer(cols = starts_with("vyroky_o_roveringu."), values_to = "procenta", names_to = "vyroky_o_roveringu") %>% 
  mutate(vyroky_o_roveringu = str_remove(vyroky_o_roveringu,"vyroky_o_roveringu."),
         procenta = as.numeric(procenta)) %>% 
  
  ggplot(aes(x=vyroky_o_roveringu,y=procenta,col = pocet_clenu_spolecenstvi,group = pocet_clenu_spolecenstvi)) +
  stat_summary(fun.data = "mean_cl_boot") + 
  stat_summary(fun.y = "mean",geom = "line")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
```
