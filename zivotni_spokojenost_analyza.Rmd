---
title: "Zivotni spokojenost"
output: html_document
---

```{r setup}
if(!grepl("cz|utf", Sys.getlocale(), ignore.case = TRUE)) {
  Sys.setlocale(locale= 'English_United States.1250')
}
library(rlang)
library(lubridate)
library(tidyverse)
library(formr)
library(here)
library(RCzechia)
library(sf)
library(cowplot)
library(showtext)
library(polycor)

save_format <- ".svg"

theme_set(theme_cowplot(20))
dark_blue_color <- "#0040ae"
darkest_fill <- "#668cce"
midd_fill <- "#b2c5e6"
# theme_update(text = element_text(family = "Roboto", color = "white"), 
#              plot.background = element_rect(fill = dark_blue_color), 
#              line = element_line(color = "white"), 
#              rect = element_rect(color = "white"), 
#              axis.text = element_text(color = "white", face = "bold"), 
#              axis.title = element_text(color = "white"),
#              axis.line = element_line(color = "white"), axis.ticks = element_line(color = "white"),
#              strip.background = element_rect(color = "white", fill = darkest_fill))


#sysfonts::font_add_google("Roboto")
#sysfonts::font_add(family = "Skaut Bold", #paste0(Sys.getenv("APPDATA"),"/../Local/Microsoft/Windows/Fonts/skaut-bold-webfont.otf"))
#showtext_auto()

source(here::here("R","tools_dotaznik.R"), encoding = "UTF-8")

```

```{r}
cela_data_raw <- nacti_dotaznik()
cela_data <- cela_data_raw %>% vyfiltruj_pouzitelne() %>% preprocess_dat(verbose = FALSE) 
check_vysledky(cela_data)
```

```{r zakladni lss analyzy}

cor.test(~let_v_junaku+lss,cela_data)
cor.test(~pocet_clenu_spolecenstvi+lss,cela_data)
cor.test(~frekvence_kratkych_akci+lss,cela_data)
cor.test(~frekvence_vicedennich_akci+lss,cela_data)
cor.test(~frekvence_velkych_akci+lss,cela_data)
cor.test(~spokojenost_s_roverskym_programem+lss,cela_data)

lss_pro_kategorie <- function(var) {
  cela_data %>% 
    group_by(!!var) %>% 
    summarize(m_lss = mean(lss, na.rm = T),sd_lss = sd(lss, na.rm = T), n = sum(!is.na(lss)) ,n_NA = sum(is.na(lss)))
}
lss_pro_kategorie(quo(kategorie_respondenta))

lss_pro_kategorie(quo(role_skauting))

lss_pro_kategorie(quo(zivotni_faze))
lss_pro_kategorie(quo(kraj))
lss_pro_kategorie(quo(sex))

```

```{r rozdelejless pro mc}

cela_data <- cela_data %>% rozsir_vsechna_mc()
cela_data %>% select(starts_with("roleFA_"),lss) %>% cor(use = "complete.obs") %>% knitr::kable(digits = 2)

n_roli <- rowSums(cela_data %>% select(starts_with("role_skauting_")) %>% as.matrix())

cela_data_role <- cela_data %>% 
  mutate(n_roli = n_roli)
cela_data %>% 
  group_by(n_roli) %>% 
  summarize(lss = mean(lss, na.rm = T), n =n()) %>% 
ggplot(aes(x=n_roli, y = lss, size = n)) + geom_point()

cela_data %>% 
  group_by(role_skauting_vedouci_roveru) %>% 
  summarize(m_lss = mean(lss, na.rm =T),
            sd_lss = sd(lss, na.rm =T),
            n = n())


cela_data %>% 
  group_by(role_skauting_vedouci_roveru) %>% 
  summarize(m_spoko = mean(spokojenost_s_roverskym_programem, na.rm =T),
            sd_spoko = sd(spokojenost_s_roverskym_programem, na.rm =T),
            n = n())

cela_data %>% 
  group_by(role_skauting_tahoun_roveru) %>% 
  summarize(m_spoko = mean(spokojenost_s_roverskym_programem, na.rm =T),
            sd_spoko = sd(spokojenost_s_roverskym_programem, na.rm =T),
            n = n())

cela_data %>% 
  group_by(role_skauting_tahoun_roveru) %>% 
  summarize(m_lss = mean(lss, na.rm =T),
            sd_lss = sd(lss, na.rm =T),
            n = n())

cela_data %>% select(starts_with("roleFA_"), lss) %>% cor(use = "complete.obs") %>% ggcorrplot::ggcorrplot(hc.order = T, type = "lower", lab =T)

t.test(spokojenost_s_roverskym_programem~role_skauting_vedouci_roveru,cela_data_role)
t.test(lss~role_skauting_vedouci_roveru,cela_data_role)


```

```{r rozdil kompetencni a lss}
expanded <- cela_data %>% expand_kompetence()

rozdil_dulezite_zvladam <- expanded %>% select(session, lss, kategorie_kompetence, kompetence_odpoved, kompetence) %>% filter(kategorie_kompetence %in% c("dulezite","zvladam")) %>%
  pivot_wider(id_cols = c("session", "kompetence", "lss"), names_from = kategorie_kompetence, values_from = kompetence_odpoved) %>%
  mutate(rozdil_dulezite_zvladam = dulezite - zvladam) %>%
  filter(!is.na(rozdil_dulezite_zvladam))

rozdil_dul_zvl_agg <- rozdil_dulezite_zvladam %>% 
  group_by(session) %>% 
  summarize(lss = mean(lss), rozdil_dulezite_zvladam = mean(rozdil_dulezite_zvladam)) 
rozdil_dul_zvl_agg %>% ggplot(aes(x = rozdil_dulezite_zvladam)) + geom_histogram()
rozdil_dul_zvl_agg %>% 
  cor.test(~lss+rozdil_dulezite_zvladam,.)

lss_cor <- expanded %>% select(session, lss, kategorie_kompetence, kompetence_odpoved, kompetence) %>% filter(kategorie_kompetence %in% c("dulezite","zvladam","rozvijim","skauting")) %>%
  pivot_wider(id_cols = c("session", "kompetence", "lss"), names_from = kategorie_kompetence, values_from = kompetence_odpoved) %>% 
  group_by(session) %>% 
  summarize(lss = mean(lss), 
            dulezite = mean(dulezite),
            zvladam = mean(zvladam),
            rozvijim = mean(rozvijim),
            skauting = mean(skauting)
            )
lss_cor %>% 
  select(lss, dulezite, zvladam, rozvijim, skauting) %>% 
  as.matrix() %>% 
  cor(use = "complete.obs") %>% knitr::kable(digits = 2)

cela_data %>% select(lss,ends_with("zvladam")) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% arrange(-lss)

cela_data %>% select(lss,ends_with("rozvijim")) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% arrange(-lss)

cela_data %>% select(lss,ends_with("dulezite")) %>% as.matrix() %>% cor(use = "complete.obs") %>% round(2) %>% as_tibble(rownames = "var") %>% 
  select(var, lss) %>% arrange(-lss)



```


```{r psc}
cela_data <- 
  cela_data %>% 
  mutate(reg_c_strediska = str_trim(reg_c_strediska)) %>% 
  mutate(reg_c_strediska_typ = 
           case_when(
             nchar(reg_c_strediska) == 8 ~ "ICO",
             str_detect(reg_c_strediska, "[:digit:]{2}[:alnum:]{1}\\.[:digit:]{2}") ~ "valid_reg_cis",
             str_detect(reg_c_strediska, "[:digit:]{3}\\.[:digit:]{2}") ~ "valid_reg_cis",
             str_detect(reg_c_strediska, "^[:digit:]{5}") ~ "cislo_bez_tecky_PSC",
             TRUE ~ NA_character_))
                       
xtabs(~reg_c_strediska_typ,cela_data)

psc_cr <- read_csv2(here::here("public_data/psc_okres_posta_utf8.csv")) %>% mutate(PSC = as.character(PSC))

psc_korektura <- cela_data %>% filter(reg_c_strediska_typ == "cislo_bez_tecky_PSC") %>% 
  mutate(regcislo_je_psc = reg_c_strediska %in% psc_cr$PSC) %>% 
  filter(!regcislo_je_psc) %>% 
  select(reg_c_strediska) %>% 
  rowwise() %>% 
  mutate(reg_c_spravne = psc_na_reg_cislo(reg_c_strediska))

write_csv2(psc_korektura,path = "public_data/psc_reg_cislo.csv")

eko_data <- readxl::read_excel(here::here("private_data/strediska_ico_ev_cislo.xlsx"))
eko_data$RegistrationNumber
ico_n_doplneni <- intersect(eko_data$IC %>% as.character() %>% unique(), cela_data$reg_c_strediska)

ico_reg_cislo <- eko_data %>% select(IC, RegistrationNumber) %>% 
  distinct() %>% 
  mutate(ic = as.character(IC)) %>% 
  filter(ic %in% ico_n_doplneni) %>% 
  filter(!is.na(ic))

write_csv(ico_reg_cislo,path = "public_data/ico_reg_cislo.csv")
```

## Roverske nastroje

```{r roverske nastroje faktorova analyza}
role_fa <- cela_data_role %>% select(starts_with("vychovne_nastroje_"))
role_fa <- sapply(role_fa, as.character)
het.mat <- hetcor(role_fa)$cor
het.mat %>% knitr::kable(digits = 2)

psych::fa.parallel(het.mat, n.obs = nrow(role_fa))

nastroje_fa_res <- psych::fa(het.mat, n.obs = nrow(role_fa), nfactors = 3, rotate = "varimax")
nastroje_fa_res
```

```{r roverske nastroje a spokojenost}

cr <- cela_data %>% select(starts_with("vychovne_nastroje_"),lss, spokojenost_s_roverskym_programem) %>% as.matrix() %>% Hmisc::rcorr() 
cr$r %>%   knitr::kable(digits = 2)
ggcorrplot::ggcorrplot(cr$r,hc.order = T, type = "lower", lab =T)
```


## Co pomaha roveringu

```{r}
cela_data %>% select(starts_with("co_pomaha")) %>% colnames()
xtabs(~co_pomaha_roveringu_financni_podpora+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_zpravodal+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_vyssi_mista+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_roversky_program+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_SI+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_akce_kratke+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_akce_dlouhe+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_neformalni_setkani+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~co_pomaha_roveringu_socialni_site+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)

```

Obecne lidem, co maji zkusenost s roveringem prijde, ze pomahaji neformalni setkani oproti tem, co nikdy ve spolecentstvi nebyli (ti veri na program). Je to tedy dost o vztazizch a neformalnich setkavani

## Problemy roveringu

```{r}
cela_data %>% select(starts_with("problemy")) %>% colnames()
xtabs(~problemy_roveringu_stredisko+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_odstehovani+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_nevidi_smysl+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_spatne_vztahy+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_bez_kvalitniho_programu+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_bez_vedeni+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_nevime_jak+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_vytizeni_oddily+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_vytizeni_mimo+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)
xtabs(~problemy_roveringu_pracovni_ceta+kategorie_respondenta, cela_data) %>% prop.table(margin = 2) %>% round(2)

```

## Faktorovka - co pomaha a co ne

```{r}
pomaha_skodi <- cela_data %>% select(starts_with("problemy_roveringu_"),-starts_with("problemy_roveringu_stredisko"),starts_with("co_pomaha_"),-co_pomaha_roveringu,-problemy_roveringu_stredisko)
psych::fa.parallel(pomaha_skodi)
fa_pomahaskodi <- psych::fa(pomaha_skodi,nfactors = 6, rotate = "varimax")
zobraz_fa(fa_pomahaskodi,nfac = 6,str_to_remove = "problemy_roveringu_") %>% knitr::kable()
cela_data <- vytvor_promenne_dle_fa(cela_data,pomaha_skodi,fa_pomahaskodi,var_name = "pomahaskodi") %>% 
  rename(ps_spatny_program = pomahaskodi1,
         ps_akcickari = pomahaskodi2,
         ps_podpora_zvenku = pomahaskodi3,
         ps_vytizeni_a_mimo = pomahaskodi4,
         ps_pokecat_s_kamosi = pomahaskodi5,
         ps_spatne_vztahy = pomahaskodi6)

cr <- cela_data %>% select(starts_with("ps_"),starts_with("roleFA_"),lss,spokojenost_s_roverskym_programem) %>% as.matrix() %>% Hmisc::rcorr()
ggcorrplot::ggcorrplot(cr$r,hc.order = T, type = "lower", lab =T)

km <- pomaha_skodi %>% kmeans(centers = 6)
cela_data$pomaha_skodi_skupina <- km$cluster
visualizuj_skupinu <- function(df_in, var, which_visualize,str_to_remove ="") {
  df <- df_in %>%
    dplyr::select(!!var, !!which_visualize) %>% 
    pivot_longer(cols = !!which_visualize,names_to = "promenna", values_to = "hodnota") %>% 
    group_by(!!var, promenna) %>% 
    summarize(hodnota = mean(hodnota))
   df %>% 
     mutate(promenna = str_remove(promenna, str_to_remove)) %>% 
     ggplot(aes(x = promenna, y = hodnota)) + 
     geom_bar(stat = "identity") +
     facet_grid(rows = vars(!!var)) + 
     theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

visualizuj_skupinu(quo(pomaha_skodi_skupina), colnames(pomaha_skodi))

library(klaR)
role_data <- cela_data %>% 
  filter(role_skauting!="")

clustery_role <- role_data %>% 
  dplyr::select(starts_with("role_skauting_")) %>% 
  kmodes(7)
role_data$role_skupina <- clustery_role$cluster

which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("role_skauting_")))
visualizuj_skupinu(role_data,quo(role_skupina), which_visualize, str_to_remove = "role_skauting_")

# 
vis_role2 <- function(ncl) {
  role_data <- cela_data %>% 
  filter(role_skauting!="")

clustery_role <- role_data %>% 
  dplyr::select(starts_with("role_skauting_")) %>% 
  kmodes(ncl)
role_data$role_skupina <- clustery_role$cluster

which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("role_skauting_")))
visualizuj_skupinu(role_data,quo(role_skupina), which_visualize, str_to_remove = "role_skauting_")
}

library(vegan)
mds_df <- role_data %>% dplyr::select(starts_with("role_skauting_")) %>% as.matrix() %>% 
  vegan::vegdist(method = "jaccard",binary = T) %>% 
  cmdscale() 
colnames(mds_df) <- c("mds_x", "mds_y")

plot(mds_df)

mds_df2 <- role_data %>% dplyr::select(starts_with("role_skauting_")) %>% as.matrix() %>% 
  vegan::metaMDS(distance = "jaccard",binary = T)

plot(mds_df2)

g <- ggplot(df, aes()) + geom_point(aes(x = mds_x, y = mds_y), size = 5)
g <- g + geom_text(aes(x = mds_x, y = mds_y, label = tags), position = position_jitter(width = 0.05, height = 0.05))
g <- g + xlab("Coordinate 1") + ylab("Coordinate 2")
print(g)

vis_role <- function(ncl) {
  role_data <- cela_data %>% 
  filter(role_skauting!="")

clustery_role <- role_data %>% 
  dplyr::select(starts_with("roleFA_")) %>% 
  kmeans(ncl)
role_data$role_skupina <- clustery_role$cluster

which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("roleFA_")))
visualizuj_skupinu(role_data,quo(role_skupina), which_visualize, str_to_remove = "roleFA_")
}
vis_role(10)

vis_role2(2)
vis_role2(3)
vis_role2(4)
vis_role2(5)
vis_role2(6)
vis_role2(7)
vis_role2(9)
vis_role2(15)

role_m <- cela_data %>% 
  filter(role_skauting!="") %>% 
  dplyr::select(starts_with("role_skauting_"))
  

```

```{r}
kompetence_fa<- expanded %>% filter(kategorie_kompetence=="dulezite") %>% dplyr::select(session,kompetence, kompetence_odpoved) %>% 
  pivot_wider(values_from = kompetence_odpoved,names_from = kompetence,values_fn = list(kompetence_odpoved = mean)) %>% dplyr::select(-session)

kompetence_fa %>% psych::fa.parallel()
kompetence_fa %>% psych::fa(nfactors = 7, rotate = "promax") %>% zobraz_fa(nfac=7,str_to_remove = "NA") %>% knitr::kable(digits =2 )
kompetence_fa %>% psych::fa(nfactors = 6, rotate = "promax") %>% zobraz_fa(nfac=6,str_to_remove = "NA") %>% knitr::kable(digits =2 )
kompetence_fa %>% psych::fa(nfactors = 5, rotate = "promax") %>% zobraz_fa(nfac=5,str_to_remove = "NA") %>% knitr::kable(digits =2 )
```

```{r}
mds_df <- role_data %>% dplyr::select(starts_with("role_skauting_")) %>% as.matrix() %>% 
  vegan::vegdist(method = "jaccard",binary = T) %>% 
  cmdscale(k=2) 


mds2_df <- role_data %>% dplyr::select(starts_with("role_skauting_")) %>% as.matrix() %>% 
  vegan::vegdist(method = "jaccard",binary = T) %>% 
  cmdscale(k=10) 


km <- kmeans(mds2_df,3)
plot(mds_df, col = km$cluster)

role_data$skupina <- km$cluster
which_visualize <- colnames(role_data %>% 
  dplyr::select(starts_with("role_skauting_")))

visualizuj_skupinu(role_data,quo(skupina), which_visualize, str_to_remove = "role_skauting_")

table(role_data$kategorie_respondenta_full,role_data$skupina)
```

## Lidi, co jezdi na kurzy


```{r}
cela_data$n_roli <- cela_data %>% dplyr::select(starts_with("role_skauting_")) %>% rowSums()
cela_data$n_sluzba <- cela_data %>% dplyr::select(starts_with("sluzba_")) %>% rowSums()
cela_data$n_nastroje <- cela_data %>% dplyr::select(starts_with("vychovne_nastroje_")) %>% rowSums()
cela_data$n_s_cim_spokojen <- cela_data %>% dplyr::select(starts_with("s_cim_spokojen_")) %>% rowSums()
cela_data$n_s_cim_nespokojen <- cela_data %>% dplyr::select(starts_with("s_cim_nespokojen_")) %>% rowSums()
cela_data %>% 
  group_by(co_zazil_radcovsky_kurz) %>% 
  summarize(lss = mean(lss, na.rm = T),
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_roverskym_programem = mean(spokojenost_s_roverskym_programem, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) 

cela_data %>% 
  group_by(co_zazil_cekatelky) %>% 
   summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_s_roverskym_programem, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=co_zazil_cekatelky)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

cela_data %>% 
  group_by(co_zazil_vudcovky) %>% 
   summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_s_roverskym_programem, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=co_zazil_vudcovky)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
cela_data %>% 
  group_by(co_zazil_roversky_kurz) %>% 
  summarize(lss = mean(lss, na.rm = T)/35,
            n_roli = mean(n_roli),
            n_sluzba = mean(n_sluzba),
            n_nastroje = mean(n_nastroje, na.rm = T),
            spokojenost_s_rp = mean(spokojenost_s_roverskym_programem, na.rm = T),
            n_s_cim_spokojen = mean(n_s_cim_spokojen, na.rm = T),
            n_s_cim_nespokojen = mean(n_s_cim_nespokojen, na.rm = T)) %>% 
  pivot_longer(values_to = "hodnota",names_to = "promenna", cols = lss:n_s_cim_nespokojen) %>% 
  ggplot(aes(x=promenna,y=hodnota,fill=co_zazil_roversky_kurz)) + geom_bar(stat ="identity", position = "dodge") + 
  theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
```

# Vek a breaking points

```{r}
cela_data1 <- cela_data %>% filter(age >= 15 & age <=26)
p1 <-cela_data1 %>% ggplot(aes(x = age, y = lss)) + stat_smooth(method = "loess")
p2 <-cela_data1 %>% ggplot(aes(x = age, y = spokojenost_s_roverskym_programem)) + stat_smooth(method = "loess")
p3 <-cela_data1 %>% ggplot(aes(x = age, y = n_roli)) + stat_smooth(method = "loess")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = n_sluzba)) + stat_smooth(method = "loess")
cela_data1 %>% ggplot(aes(x = age, y = n_s_cim_spokojen)) + stat_smooth(method = "loess")
cela_data1 %>% ggplot(aes(x = age, y = n_s_cim_nespokojen)) + stat_smooth(method = "loess")

(p1|p2)/(p3|p4)

p1 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_financni_podpora))) + stat_smooth(method = "loess") + ggtitle("Financni podpora") +ylab("procenta")
p2 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_vyssi_mista))) + stat_smooth(method = "loess") + 
  ggtitle("Vyssi mista") +ylab("procenta")
p3 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_roversky_program))) + stat_smooth(method = "loess") +
  ggtitle("Roversky program") +ylab("procenta")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_akce_kratke))) + stat_smooth(method = "loess") +
  ggtitle("Kratke akce") +ylab("procenta")
p5 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_akce_dlouhe))) + stat_smooth(method = "loess") +
  ggtitle("Dlouhe akce") +ylab("procenta")
p6 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_neformalni_setkani))) + stat_smooth(method = "loess") +
  ggtitle("Neformalni setkani") +ylab("procenta")
p7 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_socialni_site))) + stat_smooth(method = "loess") +
  ggtitle("Socialni site") +ylab("procenta")
p8 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(co_pomaha_roveringu_jine))) + stat_smooth(method = "loess") +
  ggtitle("Jine") +ylab("procenta")

(p1|p2|p3|p4)/(p5|p6|p7|p8)


p1 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_pravidelne))) + stat_smooth(method = "loess") + ggtitle("Stredisko pravidelne") +ylab("procenta")
p2 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_je_spolecenstvi))) + stat_smooth(method = "loess") + 
  ggtitle("Je spolecenstvi") +ylab("procenta")
p3 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_vlastni_akce))) + stat_smooth(method = "loess") +
  ggtitle("Vlastni akce") +ylab("procenta")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_akce_pro_druhe))) + stat_smooth(method = "loess") +
  ggtitle("Akce pro druhe") +ylab("procenta")
p5 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_rozviji_se))) + stat_smooth(method = "loess") +
  ggtitle("Rozviji se") +ylab("procenta")
p6 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_roverske_heslo))) + stat_smooth(method = "loess") +
  ggtitle("Roverske heslo") +ylab("procenta")
p7 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_vedou))) + stat_smooth(method = "loess") +
  ggtitle("Stredisko vedou") +ylab("procenta")
p8 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_stredisko_bez_ulohy))) + stat_smooth(method = "loess") +
  ggtitle("Stredisko - bez ulohy") +ylab("procenta")

(p1|p2|p3|p4)/(p5|p6|p7|p8)

cela_data1 %>% group_by(age) %>% summarize(n =sum(!is.na(vyroky_o_roveringu_stredisko_bez_ulohy)),vyroky_o_roveringu_stredisko_bez_ulohy = mean(vyroky_o_roveringu_stredisko_bez_ulohy,na.rm=T)) %>% 
  ggplot(aes(x=age,y=vyroky_o_roveringu_stredisko_bez_ulohy, size = n)) + geom_point()


p1 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_pro_jednu_gen))) + stat_smooth(method = "loess") + ggtitle("Zazil pro jednu generaci") +ylab("procenta")
p2 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_podpora_strediska))) + stat_smooth(method = "loess") + 
  ggtitle("Podpora strediska") +ylab("procenta")
p3 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_rovering_na_SR))) + stat_smooth(method = "loess") +
  ggtitle("Rovering na SR") +ylab("procenta")
p4 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_vedeni_je_rovering))) + stat_smooth(method = "loess") +
  ggtitle("Vedeni je rovering") +ylab("procenta")
p5 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_koedukovany))) + stat_smooth(method = "loess") +
  ggtitle("Koedukovany") +ylab("procenta")
p6 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_spoluprace_mimo_stredisko))) + stat_smooth(method = "loess") +
  ggtitle("Spoluprace mimo stredisko") +ylab("procenta")
p7 <- cela_data1 %>% ggplot(aes(x = age, y = 100*as.numeric(vyroky_o_roveringu_zazil_kurzy_akce))) + stat_smooth(method = "loess") +
  ggtitle("Kurzy akce") +ylab("procenta")

(p1|p2|p3|p4)/(p5|p6|p7)
plot_vek_loess <- function(var,to_remove ) {
  cela_data1 %>% mutate(procenta = !!var) %>% 
    mutate(procenta = 100*as.numeric(procenta)) %>% 
    ggplot(aes(x = age, y = procenta)) + stat_smooth(method = "loess") + ggtitle(str_remove(as_label(quo(!!var)),to_remove)) 
}

plot_letvjunaku_loess <- function(var,to_remove ) {
  cela_data1 %>% mutate(procenta = !!var) %>% 
    mutate(procenta = 100*as.numeric(procenta)) %>% 
    ggplot(aes(x = let_v_junaku, y = procenta)) + stat_smooth(method = "loess") + ggtitle(str_remove(as_label(quo(!!var)),to_remove)) 
}

p1 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_rover_automaticky),"vyroky_o_roveringu_zazil_2")
p2 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_vstupni_ritual),"vyroky_o_roveringu_zazil_2")
p3 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_snadny_prechod),"vyroky_o_roveringu_zazil_2")
p4 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_pri_prechodu_schopny),"vyroky_o_roveringu_zazil_2")
p5 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_mladsi_starsi),"vyroky_o_roveringu_zazil_2")
p6 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_prechodovy_ritual),"vyroky_o_roveringu_zazil_2")
p7 <- plot_vek_loess(quo(vyroky_o_roveringu_zazil_2_roversky_slib),"vyroky_o_roveringu_zazil_2")

(p1|p2|p3|p4)/(p5|p6|p7)

p1 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_email),"komunikacni_kanaly_existujici_")
p2 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_instagram),"komunikacni_kanaly_existujici_")
p3 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_SI),"komunikacni_kanaly_existujici_")
p4 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_diar),"komunikacni_kanaly_existujici_")
p5 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_casopis_kmen),"komunikacni_kanaly_existujici_")
p6 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_facebook),"komunikacni_kanaly_existujici_")
p7 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_krizovatka),"komunikacni_kanaly_existujici_")
p8 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_vedouci),"komunikacni_kanaly_existujici_")
(p1|p2|p3|p4)/(p5|p6|p7|p8)

p1 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_knihy),"komunikacni_kanaly_existujici_")
p2 <- plot_vek_loess(quo(komunikacni_kanaly_existujici_rovernet),"komunikacni_kanaly_existujici_")
p3 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_roverska_aplikace),"komunikacni_kanaly_hypoteticke_")
p4 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_online_kalendar),"komunikacni_kanaly_hypoteticke_")
p5 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_web),"komunikacni_kanaly_hypoteticke_")
p6 <- plot_vek_loess(quo(komunikacni_kanaly_hypoteticke_e_knihy),"komunikacni_kanaly_hypoteticke_")
(p1/p2)
(p3|p4)/(p5|p6)
```

### Let v Junaku

```{r}
p1 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_email),"komunikacni_kanaly_existujici_")
p2 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_instagram),"komunikacni_kanaly_existujici_")
p3 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_SI),"komunikacni_kanaly_existujici_")
p4 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_diar),"komunikacni_kanaly_existujici_")
p5 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_casopis_kmen),"komunikacni_kanaly_existujici_")
p6 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_facebook),"komunikacni_kanaly_existujici_")
p7 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_krizovatka),"komunikacni_kanaly_existujici_")
p8 <- plot_letvjunaku_loess(quo(komunikacni_kanaly_existujici_vedouci),"komunikacni_kanaly_existujici_")
(p1|p2|p3|p4)/(p5|p6|p7|p8)

p1 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_rover_automaticky),"vyroky_o_roveringu_zazil_2_")
p2 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_vstupni_ritual),"vyroky_o_roveringu_zazil_2_")
p3 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_snadny_prechod),"vyroky_o_roveringu_zazil_2_")
p4 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_pri_prechodu_schopny),"vyroky_o_roveringu_zazil_2_")
p5 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_mladsi_starsi),"vyroky_o_roveringu_zazil_2_")
p6 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_prechodovy_ritual),"vyroky_o_roveringu_zazil_2_")
p7 <- plot_letvjunaku_loess(quo(vyroky_o_roveringu_zazil_2_roversky_slib),"vyroky_o_roveringu_zazil_2_")

(p1|p2|p3|p4)/(p5|p6|p7)

p1 <- plot_letvjunaku_loess(quo(vychovne_nastroje_jine),"vychovne_nastroje_")
p2 <- plot_letvjunaku_loess(quo(vychovne_nastroje_vyzvy),"vychovne_nastroje_")
p3 <- plot_letvjunaku_loess(quo(vychovne_nastroje_projekty),"vychovne_nastroje_")
p4 <- plot_letvjunaku_loess(quo(vychovne_nastroje_diar),"vychovne_nastroje_")
p5 <- plot_letvjunaku_loess(quo(vychovne_nastroje_zacatek),"vychovne_nastroje_")
p6 <- plot_letvjunaku_loess(quo(vychovne_nastroje_casopis_kmen),"vychovne_nastroje_")
p7 <- plot_letvjunaku_loess(quo(vychovne_nastroje_vlastni_stezky),"vychovne_nastroje_")
p8 <- plot_letvjunaku_loess(quo(vychovne_nastroje_odborky),"vychovne_nastroje_")

(p1|p2|p3|p4)/(p5|p6|p7|p8)

p1 <- plot_letvjunaku_loess(quo(vychovne_nastroje_zahranici),"vychovne_nastroje_")
p2 <- plot_letvjunaku_loess(quo(vychovne_nastroje_velke_akce),"vychovne_nastroje_")
p3 <- plot_letvjunaku_loess(quo(vychovne_nastroje_kurzy),"vychovne_nastroje_")
p4 <- plot_letvjunaku_loess(quo(vychovne_nastroje_putovani),"vychovne_nastroje_")
p5 <- plot_letvjunaku_loess(quo(vychovne_nastroje_rovernet),"vychovne_nastroje_")
p6 <- plot_letvjunaku_loess(quo(vychovne_nastroje_wiki),"vychovne_nastroje_")
p7 <- plot_letvjunaku_loess(quo(vychovne_nastroje_nic),"vychovne_nastroje_")

(p1|p2|p3|p4)/(p5|p6|p7)
```

## Roveri v kmeni vs roveri bez kmene

```{r}
typ_respondednta_plot <- function(var) {
  
  cela_data1 %>% mutate(kategorie_respondenta_full = as.character(kategorie_respondenta_full)) %>% 
    ggplot(aes(x=kategorie_respondenta_full, y=!!var)) + stat_summary(fun.data = "mean_cl_boot") +theme(aspect.ratio = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
}
typ_respondednta_plot(quo(lss))
typ_respondednta_plot(quo(spokojenost_s_roverskym_programem))
typ_respondednta_plot(quo(n_roli))
typ_respondednta_plot(quo(n_sluzba))
typ_respondednta_plot(quo(n_nastroje))
typ_respondednta_plot(quo(n_s_cim_spokojen))
typ_respondednta_plot(quo(n_s_cim_nespokojen))

```