---
title: "Developing Stan model"
output: html_notebook
---


```{r}
library(rstan)
library(tidybayes)
library(tidyverse)
library(brms)
library(here)
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)
source(here("R","simulator.R"))
source(here("R","evaluation_tools.R"))
source(here("R","sampling_multi.R"))
source(here("R","sbc.R"))

```

```{r}
model <- stan_model(here("stan","main_model.stan"))
```


```{r}
test_data <- simulate_data(N = 20, ncat = 3, N_monotonic = 1)
fit <- sampling(model, data = test_data$observed)
evaluation_summary(fit, test_data$true)
```

```{r}
sbc_steps <- 500
sbc_results <- sbc(model, function() { simulate_data(N = 50, ncat = 3, N_monotonic = 1)}, N_steps = sbc_steps)
plot_sbc_params(sbc_results$params %>% filter(!grepl("zeta", param_name)))
plot_sbc_params(sbc_results$params %>% filter(grepl("zeta", param_name)))

```

