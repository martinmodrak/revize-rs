---
title: "Sondt analyzy"
author: "Filip Děchtěrenko"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: html_document
---

```{r load data, warning = F, message = F}
library(tidyverse)
sondy <- readRDS("private_data/sondy_180420.rds")

cisti_data <- function(df) {
  aa <- df %>% mutate(celkova_spokojenost_s_programem_rs_kmenu = recode(celkova_spokojenost_s_programem_rs_kmenu, `Velmi nespokojen/a`= 1, `Spíše nespokojen/a` = 2, `Spíše spokojen/a` = 3, `Spíše spokojen/a` = 4, `Velmi spokojen/a` = 5, .default = NA_real_),
                       spokojenost_s_frekvenci_akci2 = recode(spokojenost_s_frekvenci_akci, `Jsem spokojen/a`= 1, `Nejsem spokojen/a - přál/a bych si akce častěji` = 0, `Nejsem spokojen/a - přál/a bych si akce méně často` = 0, .default = NA_real_),
                       frekvence_rs_akci_celodenni_akce = recode(frekvence_rs_akci_celodenni_akce, `Nikdy` = 0, `Méně často než 1 za rok` = 1, `Asi jednou za půl roku` = 2, `Asi jednou za čtvrt roku` = 3, `Asi jednou měsíčně` = 4, `Asi jednou za 14 dní` = 5, `Každý týden nebo častěji` = 6),
                       frekvence_rs_akci_schuzky = recode(frekvence_rs_akci_schuzky, `Nikdy` = 0, `Méně často než 1 za rok` = 1, `Asi jednou za půl roku` = 2, `Asi jednou za čtvrt roku` = 3, `Asi jednou měsíčně` = 4, `Asi jednou za 14 dní` = 5, `Každý týden nebo častěji` = 6),
                       frekvence_rs_akci_vicedenni_akce = recode(frekvence_rs_akci_vicedenni_akce, `Nikdy` = 0, `Méně často než 1 za rok` = 1, `Asi jednou za půl roku` = 2, `Asi jednou za čtvrt roku` = 3, `Asi jednou měsíčně` = 4, `Asi jednou za 14 dní` = 5),
                       frekvence_rs_akci_tabory_expedice = recode(frekvence_rs_akci_tabory_expedice, `Nikdy` = 0, `Méně často než 1 za rok` = 1, `Asi jednou za půl roku` = 2, `Asi jednou za čtvrt roku` = 3),
                       vychovne_nastroje_vyzvy = recode(vychovne_nastroje_vyzvy, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vychovne_nastroje_projekty = recode(vychovne_nastroje_projekty, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vychovne_nastroje_rovernet = recode(vychovne_nastroje_rovernet, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vychovne_nastroje_kmen = recode(vychovne_nastroje_kmen, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vychovne_nastroje_roversky_zacatek = recode(vychovne_nastroje_roversky_zacatek, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vychovne_nastroje_diar = recode(vychovne_nastroje_diar, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vychovne_nastroje_vlastni_stezka = recode(vychovne_nastroje_vlastni_stezka, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       ma_kmen_vychovny_plan = recode(ma_kmen_vychovny_plan, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vlastni_zvyklosti_nic = recode(vlastni_zvyklosti_nic, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vlastni_zvyklosti_ritual_vstupu = recode(vlastni_zvyklosti_ritual_vstupu, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vlastni_zvyklosti_obnova_slibu = recode(vlastni_zvyklosti_obnova_slibu, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vlastni_zvyklosti_ritual_odchodu = recode(vlastni_zvyklosti_ritual_odchodu, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       vlastni_zvyklosti_ritual_predavani_vudcovstvi = recode(vlastni_zvyklosti_ritual_predavani_vudcovstvi, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       rs_kmen_prvky_vudce = recode(rs_kmen_prvky_vudce, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       rs_kmen_prvky_rada = recode(rs_kmen_prvky_rada, `Ano` = 1, `Ne` = 0, .default = NA_real_),
                       rs_kmen_prvky_ani_jedno = recode(rs_kmen_prvky_ani_jedno, `Ano` = 1, `Ne` = 0, .default = NA_real_)
                       )
  aa
}
```

# Je kmen ve stredisku?
```{r}
table(sondy$je_rs_kmen_ve_stredisku)
```

# Je kmen registrovany?

```{r}
table(sondy$je_rs_kmen_registrovany)
```

# Proc neni registrovany

```{r proc neni kmen registrovany}

sondy %>% 
  select(rs_kmen_registace_neni_registrovany_neni_vudce:rs_kmen_registrace_jine) %>% 
  gather(key = "duvod") %>% 
  filter(value!="N/A") %>%
  mutate(value = if_else(value == "Ano", 1, 0)) %>% 
  ggplot(aes(x=duvod, y = value)) + stat_summary(fun.data = "mean_cl_boot") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
  
```

# Ucast na rs - kmeans

```{r ucast na rs akcich}

sondy_ucast_tmp <- sondy %>% select(ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho) %>% filter(!is.na(ucast_rs_kmen_procenta_lide)) 
sondy_ucast <- sondy_ucast_tmp %>%
  mutate(skupina_k2 = kmeans(sondy_ucast_tmp,2)$cluster,
         skupina_k3 = kmeans(sondy_ucast_tmp,3)$cluster,
         skupina_k4 = kmeans(sondy_ucast_tmp,4)$cluster,
         skupina_k5 = kmeans(sondy_ucast_tmp,5)$cluster)

sondy_ucast %>% 
  summarize_at(.vars = vars(ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)


sondy_ucast %>% 
  group_by(skupina_k2) %>% 
  summarize_at(.vars = vars(ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k2) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

sondy_ucast %>% 
  group_by(skupina_k3) %>% 
  summarize_at(.vars = vars(ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k3) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

sondy_ucast %>% 
  group_by(skupina_k4) %>% 
  summarize_at(.vars = vars(ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", ucast_rs_kmen_procenta_lide:ucast_rs_kmen_procenta_neco_jineho) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k4) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

```

# Ucast na rs - kmeans

```{r neucast na rs akcich}

sondy_neucast_tmp <- sondy %>% select(neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine) %>% 
  filter(!is.na(neucast_rs_kmen_procenta_prace_na_stredisku)) 
sondy_neucast <- sondy_neucast_tmp %>%
  mutate(skupina_k2 = kmeans(sondy_neucast_tmp,2)$cluster,
         skupina_k3 = kmeans(sondy_neucast_tmp,3)$cluster,
         skupina_k4 = kmeans(sondy_neucast_tmp,4)$cluster,
         skupina_k5 = kmeans(sondy_neucast_tmp,5)$cluster)

sondy_neucast %>% 
  summarize_at(.vars = vars(neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)


sondy_neucast %>% 
  group_by(skupina_k2) %>% 
  summarize_at(.vars = vars(neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k2) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

sondy_neucast %>% 
  group_by(skupina_k3) %>% 
  summarize_at(.vars = vars(neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k3) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

sondy_neucast %>% 
  group_by(skupina_k4) %>% 
  summarize_at(.vars = vars(neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", neucast_rs_kmen_procenta_prace_na_stredisku:neucast_rs_kmen_procenta_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k4) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

```

# Pocty dat

Zda vubec nektere promenne ma smysl davat do analyz

## vlastni zvyklosti

```{r pocty dat vlastni zvyklosti}
table(sondy$vlastni_zvyklosti_obnova_slibu)
table(sondy$vlastni_zvyklosti_ritual_odchodu)
table(sondy$vlastni_zvyklosti_ritual_vstupu)
table(sondy$vlastni_zvyklosti_ritual_predavani_vudcovstvi)
table(sondy$vlastni_zvyklosti_nic)
```

Ok, to znamena, ze ma smysl pouzivat jen ritual vstupu, ci rozdelovat lidi, zda maji/nemaji ritual
ritual jine je kvali

## Vychovne nastroje

```{r pocty dat vychovne nastroje}
table(sondy$vychovne_nastroje_vyzvy)
table(sondy$vychovne_nastroje_projekty)
table(sondy$vychovne_nastroje_rovernet)
table(sondy$vychovne_nastroje_kmen)
table(sondy$vychovne_nastroje_roversky_zacatek)
table(sondy$vychovne_nastroje_diar)
table(sondy$vychovne_nastroje_vlastni_stezka)
```

## Pomoc u dětských oddílů

```{r pomoc u detskych oddilu}
table(sondy$pomoc_u_detskych_oddilu_jsem_stale_clenem)
table(sondy$pomoc_u_detskych_oddilu_nic)
table(sondy$pomoc_u_detskych_oddilu_vudce_oddilu)
table(sondy$pomoc_u_detskych_oddilu_vedu_oddil_papirove_nekdo_jiny)
table(sondy$pomoc_u_detskych_oddilu_zastupce_oddilu_nebo_oddilovy_radce)
table(sondy$pomoc_u_detskych_oddilu_obecna_pomoc_u_oddilu_bez_funkce)
table(sondy$pomoc_u_detskych_oddilu_radce_druziny)
table(sondy$pomoc_u_detskych_oddilu_pomoc_na_schuzkach)
table(sondy$pomoc_u_detskych_oddilu_pomoc_na_tabore)
table(sondy$pomoc_u_detskych_oddilu_pomoc_na_vypravach)
table(sondy$pomoc_u_detskych_oddilu_pomoc_na_klubovne_zakladne_brigadach)
table(sondy$pomoc_u_detskych_oddilu_jine)
```

Prekvapuje me, kolik lidi je ve vedeni oddilu! Nejak pomaha hodne lidi

## Probehle akce

```{r}
table(sondy$roverske_akce_probehle_2roky_zavody)
table(sondy$roverske_akce_diskuze)
table(sondy$roverske_akce_probehle_expedice)
table(sondy$roverske_akce_probehle_tabor)
table(sondy$roverske_akce_duchovni_programy)
table(sondy$roverske_akce_pobyt_v_prirode)
table(sondy$roverske_akce_zahranicni_akce)
table(sondy$roverske_akce_kulturni_akce)
table(sondy$roverske_akce_tradicni_akce)
table(sondy$roverske_akce_setkani_bez_programu_hospoda)
table(sondy$roverske_akce_sluzba)
table(sondy$roverske_akce_velke_rs_akce)
table(sondy$roverske_akce_kurzy_vzdelavaci_akce)
```

# Spokojenost s programem

```{r korelacni matice}
table(sondy$spokojenost_s_frekvenci_akci)
table(sondy$celkova_spokojenost_s_programem_rs_kmenu)
aa <- sondy %>% cisti_data()
c <- aa %>% select(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno) %>% 
  filter(!is.na(spokojenost_s_frekvenci_akci2)) %>% as.matrix() %>% Hmisc::rcorr(type = "spearman")
c$r%>% round(2) %>% knitr::kable()

# vlastni_zvyklosti_obnova_slibu = recode(vlastni_zvyklosti_obnova_slibu, `Ano` = 1, `Ne` = 0, .default = NA_real_),
# vlastni_zvyklosti_ritual_odchodu = recode(vlastni_zvyklosti_ritual_odchodu, `Ano` = 1, `Ne` = 0, .default = NA_real_),
# vlastni_zvyklosti_ritual_predavani_vudcovstvi = recode(vlastni_zvyklosti_ritual_predavani_vudcovstvi, `Ano` = 1, `Ne` = 0, .default = NA_real_),
```

# Podil prace ve stredisku

```{r}
sondy_podil_casu_tmp <- sondy %>% select(id, podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine) %>% 
  filter(!is.na(podil_casu_ve_skautu_u_detskych_oddilu)) 
sondy_podil_casu <- sondy_podil_casu_tmp %>% 
  mutate(skupina_k2 = kmeans(sondy_podil_casu_tmp %>% select(-id),2)$cluster,
         skupina_k3 = kmeans(sondy_podil_casu_tmp %>% select(-id),3)$cluster,
         skupina_k4 = kmeans(sondy_podil_casu_tmp %>% select(-id),4)$cluster,
         skupina_k5 = kmeans(sondy_podil_casu_tmp %>% select(-id),5)$cluster)

sondy_podil_casu %>% 
  summarize_at(.vars = vars(podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)


sondy_podil_casu %>% 
  group_by(skupina_k2) %>% 
  summarize_at(.vars = vars(podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k2) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

sondy_podil_casu %>% 
  group_by(skupina_k3) %>% 
  summarize_at(.vars = vars(podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k3) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

sondy_podil_casu %>% 
  group_by(skupina_k4) %>% 
  summarize_at(.vars = vars(podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine), .funs = mean) %>%
  gather(key = "duvod", value = "prumer", podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine) %>%
  ggplot(aes(x = duvod, y = prumer)) +
  geom_point() + 
  facet_grid(~skupina_k4) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(0,100)

```

# Jak se lisi korelacni matice u jednotlivych subskupin

Vezmeme podskupiny podle kmeans a replikujeme na nich korelacni matice

```{r korelacni matice u podskupin}
sondy2 <- sondy %>% left_join(sondy_podil_casu %>% select(-(podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine)), by = "id")

aa <- sondy2 %>% cisti_data()
```

## 2 skupiny

```{r korelace pro 2 skupiny}

c <- aa %>% 
  filter(skupina_k2 == 1) %>%
  select(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c$r%>% round(2) %>% knitr::kable()

c <- aa %>% 
  filter(skupina_k2 == 2) %>%
  select(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c$r%>% round(2) %>% knitr::kable()

```

## 3 skupiny

```{r korelace pro 3 skupiny}

c <- aa %>% 
  filter(skupina_k3 == 1) %>%
  select(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c$r%>% round(2) %>% knitr::kable()

c <- aa %>% 
  filter(skupina_k3 == 2) %>%
  select(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c$r%>% round(2) %>% knitr::kable()

c <- aa %>% 
  filter(skupina_k3 == 3) %>%
  select(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c$r%>% round(2) %>% knitr::kable()

```

# Clusterováni na základě typu proběhlých programů

```{r}

plot_cluster <- function(df,k_group, data_vars, xlabel = "akce",ylim_min = 0, ylim_max = 1 ){
  df$gr <- df[[k_group]]
  df %>% 
  group_by(gr) %>% 
  summarize_at(.vars = data_vars, .funs = mean) %>%
  gather(key = xlabel, value = "prumer", -gr) %>%
  ggplot(aes(x = xlabel, y = prumer)) +
  geom_point() + 
  facet_wrap(~gr) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(ylim_min, ylim_max)
}

plot_cluster2 <- function(df,k_group, data_vars, xlabel = "akce",ylim_min = 0, ylim_max = 1 ){
  df$gr <- df[[k_group]]
  df %>% 
  group_by(gr) %>% 
  summarize_at(.vars = data_vars, .funs = mean) %>%
  gather(key = xlabel, value = "prumer", -gr) %>%
  ggplot(aes(x = xlabel, y = prumer, col = as.factor(gr), group = as.factor(gr))) +
  geom_point() +
    geom_line() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylim(ylim_min, ylim_max)
}

sondy_program_tmp <- sondy %>% select(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce) %>% mutate_all(funs(recode(.,"Ano"=T,"Ne"=F,"N/A"=NA))) %>%
mutate(id = sondy$id) %>% 
  filter(!is.na(roverske_akce_probehle_2roky_zavody))

sondy_program <- sondy_program_tmp %>% 
  mutate(k2 = kmeans(sondy_program_tmp %>% select(-id),2)$cluster,
         k3 = kmeans(sondy_program_tmp %>% select(-id),3)$cluster,
         k4 = kmeans(sondy_program_tmp %>% select(-id),4)$cluster,
         k5 = kmeans(sondy_program_tmp %>% select(-id),5)$cluster,
         k6 = kmeans(sondy_program_tmp %>% select(-id),6)$cluster,
         k7 = kmeans(sondy_program_tmp %>% select(-id),7)$cluster,
         k8 = kmeans(sondy_program_tmp %>% select(-id),8)$cluster,
         k9 = kmeans(sondy_program_tmp %>% select(-id),9)$cluster,
         k10 = kmeans(sondy_program_tmp  %>% select(-id),10)$cluster)
         
plot_cluster2(sondy_program, "k2", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  

plot_cluster2(sondy_program, "k3", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  
plot_cluster2(sondy_program, "k4", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  
plot_cluster2(sondy_program, "k5", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  
plot_cluster2(sondy_program, "k6", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  

plot_cluster2(sondy_program, "k7", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  
plot_cluster2(sondy_program, "k8", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  
plot_cluster2(sondy_program, "k9", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  
plot_cluster(sondy_program, "k10", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  

plot_cluster2(sondy_program, "k5", vars(roverske_akce_probehle_2roky_zavody:roverske_akce_kurzy_vzdelavaci_akce))  

```

## Korelace per akcni kmeny

```{r korelace po skupinach}


ab <- sondy %>% left_join(sondy_program %>% select(id, k2:k10), by = "id") %>% cisti_data()

v <- vars(spokojenost_s_frekvenci_akci2, celkova_spokojenost_s_programem_rs_kmenu, frekvence_rs_akci_celodenni_akce, frekvence_rs_akci_schuzky, frekvence_rs_akci_vicedenni_akce, frekvence_rs_akci_tabory_expedice,vychovne_nastroje_vyzvy:vychovne_nastroje_vlastni_stezka, vlastni_zvyklosti_nic:vlastni_zvyklosti_ritual_predavani_vudcovstvi,rs_kmen_prvky_vudce:rs_kmen_prvky_ani_jedno)

c1 <- ab %>% 
  filter(k2 == 1) %>%
  select(v) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c1$r%>% round(2) %>% knitr::kable()

c2 <- ab %>% 
  filter(k2 == 2) %>%
  select(v) %>% 
  as.matrix() %>% Hmisc::rcorr(type = "spearman")
c2$r%>% round(2) %>% knitr::kable()

(c1$r - c2$r) %>% round(2) %>% knitr::kable() 

ab %>% 
  group_by(k2) %>%
  summarize_at(v, .funs = funs(mean,sd),na.rm = T) %>% 
  round(2) %>%  t()

```

```{r dvoje kmeans}
dva_kmeans <- ab %>% left_join(sondy_podil_casu %>% select(-(podil_casu_ve_skautu_u_detskych_oddilu:podil_casu_ve_skautu_jine)), by = "id")
xtabs(~k2+skupina_k3, dva_kmeans)
xtabs(~k2+skupina_k3, dva_kmeans) %>% chisq.test()
xtabs(~k2+skupina_k4, dva_kmeans)
xtabs(~k2+skupina_k4, dva_kmeans) %>% chisq.test()

```
